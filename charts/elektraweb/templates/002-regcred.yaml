{{- define "imagePullSecret" }}
{{- with .Values.regcred }}
{{- printf "{\"auths\":{\"ghcr.io\":{\"auth\":\"%s\"}}}" (printf "%s:%s" .user .key | b64enc) | b64enc }}
{{- end }}
{{- end }}
kind: Secret
apiVersion: v1
metadata:
  name: regcred
  namespace: default
data:
  .dockerconfigjson: {{ template "imagePullSecret" . }}
type: kubernetes.io/dockerconfigjson
